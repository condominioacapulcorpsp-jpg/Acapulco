<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Correspond√™ncia - Portaria</title>
<style>
:root{
  --azul:#1f2b48;
  --verde:#1fb954;
  --fundo:#f0f2f5;
  --branco:#fff;
  --cinza:#ccc;
  --texto:#111;
}
body {
  font-family: 'Segoe UI', Arial, sans-serif;
  background: var(--fundo);
  margin: 0;
  padding: 0;
  color: var(--texto);
}
nav {
  background: var(--azul);
  color: white;
  display: flex;
  justify-content: space-around;
  padding: 10px;
}
nav button {
  background: none;
  border: none;
  color: white;
  font-size: 16px;
  cursor: pointer;
  transition: 0.3s;
}
nav button:hover {
  color: var(--verde);
}
section {
  display: none;
  padding: 20px;
}
section.active {
  display: block;
}
h2 {
  margin-top: 0;
  color: var(--azul);
}
input, select, button {
  display: block;
  width: 100%;
  margin: 10px 0;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid var(--cinza);
  font-size: 15px;
}
button {
  background: var(--azul);
  color: white;
  border: none;
  cursor: pointer;
}
button:hover {
  background: var(--verde);
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
  background: var(--branco);
  border-radius: 8px;
  overflow: hidden;
}
th, td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: center;
}
th {
  background: var(--azul);
  color: white;
}
.signature-canvas {
  border: 2px dashed var(--azul);
  width: 100%;
  height: 150px;
  border-radius: 8px;
}
img.preview {
  width: 80px;
  height: 80px;
  object-fit: cover;
  margin: 5px;
  border: 1px solid #aaa;
  border-radius: 8px;
}
video {
  width: 100%;
  border-radius: 8px;
}
.pendente {
  background: #fff3cd;
}
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<nav>
  <button onclick="mostrarAba('registrar')">üì¶ Registrar</button>
  <button onclick="mostrarAba('registros')">üóÇ Registros</button>
  <button onclick="mostrarAba('contatos')">üë• Contatos</button>
</nav>

<section id="registrar" class="active">
  <h2>Registrar Correspond√™ncia</h2>
  <input id="pesquisaContato" placeholder="üîç Pesquisar contato..." oninput="filtrarContatos()" />
  <select id="contatoSelect"></select>
  <select id="descricao">
    <option value="">Selecione o tipo de entrega</option>
    <option value="Correios">Correios</option>
    <option value="Mercado Livre">Mercado Livre</option>
    <option value="Loggi">Loggi</option>
    <option value="Outros">Outros</option>
  </select>
  <video id="video" autoplay playsinline style="display:none;"></video>
  <button onclick="abrirCamera()">üì∑ Abrir C√¢mera</button>
  <button id="capturarBtn" style="display:none;" onclick="capturarFoto()">üì∏ Capturar Imagem</button>
  <canvas id="canvas" width="640" height="480" style="display:none;"></canvas>
  <div id="fotoPreview"></div>
  <button onclick="registrarCorrespondencia()">üíæ Salvar Registro</button>
</section>

<section id="registros">
  <h2>Registros de Correspond√™ncias</h2>
  <table id="tabelaRegistros">
    <thead><tr><th>Nome</th><th>Entrega</th><th>Foto</th><th>Assinatura</th><th>Data Registro</th><th>Baixa</th><th>A√ß√µes</th></tr></thead>
    <tbody></tbody>
  </table>
</section>

<section id="contatos">
  <h2>Contatos</h2>
  <input id="nome" placeholder="Nome" />
  <input id="telefone" placeholder="Telefone" />
  <input id="apartamento" placeholder="Apartamento" />
  <button onclick="salvarContato()">üíæ Salvar Contato</button>
  <table id="tabelaContatos">
    <thead><tr><th>Nome</th><th>Telefone</th><th>Apartamento</th><th>A√ß√µes</th></tr></thead>
    <tbody></tbody>
  </table>
</section>

<div id="modalAssinatura" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;
background:rgba(0,0,0,0.7);justify-content:center;align-items:center;z-index:1000;">
  <div style="background:white;padding:20px;border-radius:8px;max-width:400px;width:90%;">
    <h3>‚úç Coletar Assinatura</h3>
    <canvas id="assinaturaCanvas" class="signature-canvas"></canvas>
    <button onclick="salvarAssinatura()">Salvar Assinatura</button>
    <button onclick="fecharModalAssinatura()">Cancelar</button>
  </div>
</div>

<script>
/* === CONFIG SUPABASE === */
const SUPABASE_URL = "https://vdxiphzxdpwggydezbzw.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZkeGlwaHp4ZHB3Z2d5ZGV6Ynp3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5MDQxMTQsImV4cCI6MjA3ODQ4MDExNH0.IQLGlZlcgEw8-E_TbnfZwrzs8eJt0Ky4WtYrmyCr1aI";
const db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let registros = JSON.parse(localStorage.getItem("registros")) || [];
let contatos = JSON.parse(localStorage.getItem("contatos")) || [];
let registroIndexAssinatura = null;
let cameraStream = null;
let fotoTemporaria = null;

async function sincronizarSupabase() {
  if (!navigator.onLine) return;
  for (const c of contatos) {
    await db.from("contatos").upsert(c);
  }
  for (const r of registros) {
    await db.from("registros").upsert(r);
  }
}

/* ===== UI ===== */
function mostrarAba(id) {
  document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

/* ===== CONTATOS ===== */
function atualizarContatos() {
  const tabela = document.querySelector("#tabelaContatos tbody");
  const select = document.getElementById("contatoSelect");
  tabela.innerHTML = "";
  select.innerHTML = "<option value=''>Selecione um contato</option>";
  contatos.forEach((c, i) => {
    const row = tabela.insertRow();
    row.insertCell(0).textContent = c.nome;
    row.insertCell(1).textContent = c.telefone;
    row.insertCell(2).textContent = c.apartamento;
    row.insertCell(3).innerHTML = `
      <button onclick="editarContato(${i})">‚úè Editar</button>
      <button onclick="excluirContato(${i})">üóë Excluir</button>`;
    select.innerHTML += `<option value="${i}">${c.nome}</option>`;
  });
}

async function salvarContato() {
  const nomeEl = document.getElementById('nome');
  const telefoneEl = document.getElementById('telefone');
  const apartamentoEl = document.getElementById('apartamento');
  
  const nome = nomeEl.value.trim();
  const telefone = telefoneEl.value.trim();
  const apartamento = apartamentoEl.value.trim();
  
  if (!nome) return alert("Informe o nome!");
  
  const contato = { nome, telefone, apartamento };
  contatos.push(contato);
  localStorage.setItem("contatos", JSON.stringify(contatos));
  atualizarContatos();
  await db.from("contatos").upsert(contato);
}

function editarContato(i) { /* ... igual ao seu c√≥digo anterior ... */ }
function excluirContato(i) { /* ... igual ao seu c√≥digo anterior ... */ }

window.addEventListener("online", sincronizarSupabase);
atualizarContatos();
</script>
</body>
</html>
